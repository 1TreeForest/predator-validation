import{css as e,html as t,LitElement as n}from"../../../lit/index.js";import{DDDSuper as o}from"../../d-d-d/d-d-d.js";import{DDDDataAttributes as i}from"../../d-d-d/lib/DDDStyles.js";import"../video-player.js";import"../../simple-icon/lib/simple-icon-button-lite.js";import"../../simple-icon/lib/simple-icon-lite.js";import"../../simple-icon/lib/simple-icons.js";import"../../hax-iconset/lib/simple-hax-iconset.js";import"../../simple-modal/simple-modal.js";class LecturePlayer extends(o(n)){static get styles(){return[super.styles,i,e`
        :host {
          font-family: var(--ddd-font-primary, sans-serif);
        }

        #lectureActivation {
          font-family: var(--ddd-font-primary, sans-serif);
          font-size: var(--ddd-theme-body-font-size, 16px);
          background: var(--ddd-theme-primary);
          color: var(--ddd-theme-bgContrast, black);
          cursor: pointer;
          padding: var(--ddd-spacing-4);
          height: fit-content;
          margin: auto;
          border-radius: var(--ddd-radius-sm);
        }

        @media (max-width: 1200px) {
          :host {
            grid-template-columns: 1fr;
          }
        }
      `]}constructor(){super()}static get properties(){return{activeIndex:{type:String,reflect:!0},source:{type:String,reflect:!0}}}updated(e){super.updated(e),e.forEach(((e,t)=>{"activeIndex"===t&&(document.querySelector("video-player").playing||this.play(),console.log("activeIndex changed to: ",this.activeIndex),console.log(document.querySelector("#"+this.activeIndex)),this.seek(document.querySelector("#"+this.activeIndex).timestamp),this.updateJumbotron(),this.updatePlaylist(),this.checkDisabledButtons())}))}scan(){const e=document.querySelectorAll("lecture-anchor");console.log(e);const t=Array.from(e);t.sort(((e,t)=>parseInt(e.getAttribute("timestamp"),10)-parseInt(t.getAttribute("timestamp"),10))),t.forEach(((e,t)=>{e.id=`slide-${t+1}`,e.addEventListener("click",(()=>{this.activeIndex=e.id}))})),this.setJumbotronAttributes()}setJumbotronAttributes(){console.log("setJumbotronAttributes"),document.querySelectorAll("lecture-anchor").forEach((e=>{let t=e.parentElement;if(t&&t.tagName.startsWith("H")){e.setAttribute("jumbotronHeading",e.text);let n=t.nextElementSibling,o="";for(;n&&!n.tagName.startsWith("H");)o+=n.outerHTML,n=n.nextElementSibling;e.setAttribute("jumbotronContent",o)}else{let n=t.previousElementSibling;for(;n&&!n.tagName.startsWith("H");)n=n.previousElementSibling;n?e.setAttribute("jumbotronHeading",n.textContent):e.setAttribute("jumbotronHeading",e.getAttribute("text")),e.setAttribute("jumbotronContent",t.outerHTML)}let n=document.createElement("div");n.innerHTML=e.getAttribute("jumbotronContent"),n.querySelectorAll("lecture-anchor").forEach((e=>{e.removeAttribute("id")})),e.setAttribute("jumbotronContent",n.innerHTML)})),this.addPrevNextListeners(),this.updatePlaylist()}addPrevNextListeners(){console.log("addPrevNextListeners");const e=document.querySelector("#prevSlideBtn"),t=document.querySelector("#nextSlideBtn");this.activeIndex||(this.activeIndex="slide-1"),e.addEventListener("click",(()=>{const e=this.activeIndex.split("-")[1]>1?this.activeIndex.split("-")[1]-1:null;e&&(this.activeIndex="slide-"+e)})),t.addEventListener("click",(()=>{const e=document.querySelectorAll("lecture-anchor[id]").length;console.log(e),console.log(this.activeIndex.split("-")[1]),console.log(parseInt(this.activeIndex.split("-")[1])+1),console.log(parseInt(this.activeIndex.split("-")[1])+1<e);const t=this.activeIndex.split("-")[1]<e?parseInt(this.activeIndex.split("-")[1])+1:null;t?this.activeIndex="slide-"+t:this.endVideo()}))}updateJumbotron(){console.log("updateJumbotron");const e=document.querySelector(".jumbotron");console.log(e),e.innerHTML="";const t=document.querySelector(`#${this.activeIndex}`);if(console.log(t),t){const n=document.createElement("h2");n.innerText=t.getAttribute("jumbotronHeading"),e.appendChild(n);const o=document.createElement("div");o.id="jumbotron-desc",o.innerHTML=t.getAttribute("jumbotronContent"),e.appendChild(o)}}updatePlaylist(){console.log("updatePlaylist");const e=document.querySelector(".timestampList");e.innerHTML="";this.getSortedAnchors().forEach((t=>{const n=document.createElement("button");n.classList.add("timestampBtn"),n.innerText=t.getAttribute("jumbotronHeading"),n.timestamp=t.getAttribute("timestamp"),n.addEventListener("click",(()=>{this.activeIndex=t.id})),t.id===this.activeIndex&&n.classList.add("active"),e.appendChild(n)})),document.querySelector(".timestampList").scrollTo({left:document.querySelector(".timestampBtn.active").offsetLeft-125,behavior:"smooth"})}getSortedAnchors(){let e=[],t=1,n=document.querySelector(`#slide-${t}`);for(;n;)e.push(n),t++,n=document.querySelector(`#slide-${t}`);return e}seek(e){console.log("seek"),console.log(e),console.log(document.querySelector("video-player").shadowRoot.querySelector("a11y-media-player")),document.querySelector("video-player").shadowRoot.querySelector("a11y-media-player")&&document.querySelector("video-player").shadowRoot.querySelector("a11y-media-player").seek(e)}play(){document.querySelector("video-player").shadowRoot.querySelector("a11y-media-player")&&document.querySelector("video-player").shadowRoot.querySelector("a11y-media-player").play()}checkDisabledButtons(){console.log("checkDisabledButtons");const e=document.querySelector("#prevSlideBtn"),t=parseInt(this.activeIndex.split("-")[1]);1===t?e.setAttribute("disabled","true"):e.removeAttribute("disabled"),t!==document.querySelectorAll("lecture-anchor").length&&document.querySelector("#nextSlideBtn").removeAttribute("disabled")}endVideo(){console.log("endVideo"),document.querySelector("video-player").shadowRoot.querySelector("a11y-media-player").pause(),document.querySelector("#nextSlideBtn").setAttribute("disabled","true");let e=document.createElement("div");e.setAttribute("data-primary","11"),e.innerHTML='<button class="endBtn">Close Lecture Player</button>',e.classList.add("endBtnContainer"),document.querySelector(".jumbotron").appendChild(e),document.querySelector(".endBtn").addEventListener("click",(()=>{document.querySelector("simple-modal").close()})),document.querySelector(".endBtn").scrollIntoView({behavior:"smooth"})}showModal(e){console.log("showModal");let t=document.createElement("div");t.classList.add("modal-content"),t.innerHTML=`\n    <style>\n      simple-modal{\n        --simple-modal-width: 95%;\n        --simple-modal-height: 95%;\n        font-family: var(--ddd-font-primary, sans-serif);\n      }\n\n      .modal-content{\n        display: grid;\n        grid-template-columns: 1.5fr 1fr;\n        width: calc(100% - 32px);\n        height: 100%;\n        gap: var(--ddd-spacing-4);\n      }\n\n      video-player{\n        max-width: 100%;\n        max-height: 100%;\n      }\n\n      .videoSection{\n        display: grid;\n        grid-template-rows: 1fr auto;\n        max-width: 100%;\n        max-height: 80vh;\n      }\n\n      .playlist{\n        display: grid;\n        grid-template-columns: .5fr 5fr .5fr;\n        gap: var(--ddd-spacing-2);\n        max-width: 100%;\n      }\n\n      .overflow-ellipsis{\n        max-width: 200px;\n        display: inline-block;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        word-wrap: break-word;\n        word-break: break-word;\n      }\n\n      .timestampList {\n        display: flex; /* Use flexbox to layout items in a row */\n        flex-wrap: nowrap; /* Prevent wrapping of items */\n        border: var(--ddd-border-xs);\n        border-color: var(--ddd-theme-default-coalyGray, black);\n        background: #bab8b8;\n        overflow-x: auto; /* Enable horizontal scrolling */\n        overflow-y: hidden; /* Hide vertical overflow */\n      }\n      \n      .timestampBtn {\n        flex-shrink: 0; /* Prevent buttons from shrinking */\n        background: white;\n        border: none;\n        border-right: 1px solid black; /* Keep the border-right */\n        cursor: pointer;\n        font-size: 24px;\n        padding: 16px; /* Add padding to space out the buttons */\n        height: 75px;\n        width: 200px;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        white-space: nowrap;\n        font-family: var(--ddd-font-primary, sans-serif);\n      }\n\n      .timestampBtn:not(:last-child){\n        border-right: 1px solid black;\n      }\n\n      .jumbotron{\n        display: flex;\n        flex-direction: column;\n        justify-content: start;\n        align-items: start;\n      }\n\n      #jumbotron-desc{\n        padding: 8px;\n        width: 100%;\n      }\n\n      .timestamp-navigation-button{\n        background: white;\n        cursor: pointer;\n        padding: 4px;\n        height: fit-content;\n        margin: auto;\n      }\n      \n      .timestampBtn.active{\n        background: #dfedf5;\n      }\n\n      .endBtnContainer{\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n        height: 100%;\n        margin: auto;\n      }\n\n      .endBtn{\n        font-family: var(--ddd-font-primary, sans-serif);\n        font-size: var(--ddd-theme-body-font-size, 16px);\n        background: var(--ddd-theme-primary);\n        color: var(--ddd-theme-bgContrast, black);\n        cursor: pointer;\n        padding: var(--ddd-spacing-4);\n        height: fit-content;\n        margin: auto;\n        border-radius: var(--ddd-radius-sm);\n        box-shadow: none;\n        animation: pulse 1.2s ease infinite;\n      }\n\n      .endBtn:hover{\n        animation: none;\n      }\n\n      @keyframes pulse {\n        0% {\n          box-shadow: 0 0 0 0 rgba(188, 32, 75, 0.7);\n        }\n        70% {\n          box-shadow: 0 0 0 10px rgba(188, 32, 75, 0);\n        }\n        100% {\n          box-shadow: 0 0 0 0 rgba(188, 32, 75, 0);\n        }\n      }\n    </style>\n      <div class="videoSection">\n          <video-player source="${this.source}" source-type="${this.sourceType}"></video-player>\n          <div class="playlist">\n            <button class="timestamp-navigation-button" id="prevSlideBtn"><simple-icon-lite icon="lrn:arrow-left"></simple-icon-lite></button>\n            <div class="timestampList">\n            </div>\n            <button class="timestamp-navigation-button" id="nextSlideBtn"><simple-icon-lite icon="lrn:arrow-right"></simple-icon-lite></button>\n          </div>\n        </div>\n        <div class="jumbotron">\n      </div>\n    `;const n=new CustomEvent("simple-modal-show",{bubbles:!0,cancelable:!0,detail:{elements:{content:t}}});dispatchEvent(n),this.scan()}render(){return t`
      <button id="lectureActivation" @click="${this.showModal}">
        Show Modal
      </button>
    `}}window.customElements.define("lecture-player",LecturePlayer);